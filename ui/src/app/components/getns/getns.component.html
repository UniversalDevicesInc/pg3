<div style="text-align: center;">
  <h1>Polyglot NodeServer Store</h1>
  <h4 *ngIf="nsList">
    Current NodeServers:
    <span style="vertical-align: top;" class="badge badge-secondary">{{ nsList.length }}</span>
  </h4>
  <button (click)="getNSList()" class="btn btn-primary">Refresh</button>
  <button (click)="addNS()" class="btn btn-primary">Add New NodeServer to the Store</button>
</div>
<br />

<div *ngIf="received">
  <table class="table table-striped table-bordered table-hover" style="font-size: 12px;">
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th width="10%">Name</th>
          <th width="5%">Version</th>
          <th width="10%">Author</th>
          <th width="6%">Language</th>
          <th width="50%">Description</th>
          <th width="15%" style="text-align: center; vertical-align: middle; margin: auto;">
            Installed
          </th>
          <th width="7%"></th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let ns of nsList; let i = index"
          [class.active]="i == selectedRow"
          text-align="center"
        >
          <td style="vertical-align: middle;">
            <a href="{{ ns.url }}">{{ ns.name }}</a>
          </td>
          <td style="vertical-align: middle;">{{ ns.version }}</td>
          <td style="vertical-align: middle;">{{ ns.author }}</td>
          <td style="vertical-align: middle;">{{ ns.language }}</td>
          <td style="vertical-align: middle;">{{ ns.desc }}</td>
          <td style="text-align: center; vertical-align: middle; margin: auto;">
            <ng-container
              *ngIf="sockets.getNodeServers | async | filter: 'name':ns.name as nodeServers"
            >
              <ng-container *ngIf="nodeServers.length <= 0; else listInstalled">
                None
              </ng-container>
              <ng-template #listInstalled>
                <ng-container *ngFor="let nodeServer of nodeServers"
                  >{{ nodeServer?.nickname || nodeServer?.name }}({{ nodeServer?.profileNum }})
                </ng-container>
              </ng-template>
            </ng-container>
          </td>
          <td style="text-align: center; vertical-align: middle; margin: auto;">
            <button (click)="open(install, ns)" class="btn btn-primary btn-sm">
              Install
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </table>
</div>

<p *ngIf="!received">
  Getting installable NodeServer list from Polyglot Store. Standby....
</p>
<br />

<!-- install Modal -->
<ng-template #install let-modal>
  <!-- Header -->
  <div class="modal-header">
    <h4 class="modal-title text-white">Install {{ current['name'] }}?</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true"><fa-icon class="fa-1x" [icon]="faWindowClose"></fa-icon></span>
    </button>
  </div>
  <!-- Body -->
  <div class="modal-body text-white">
    <h6 class="text-white">NodeServer:</h6>
    <table class="table table-striped table-bordered table-hover" style="font-size: 12px;">
      <tbody>
        <tr>
          <th width="25%" style="vertical-align: middle;"><b>Name</b></th>
          <td style="vertical-align: middle;">{{ current['name'] }}</td>
        </tr>
        <tr>
          <th style="vertical-align: middle;"><b>Language</b></th>
          <td style="vertical-align: middle;">{{ current['language'] }}</td>
        </tr>
        <tr>
          <th style="vertical-align: middle;"><b>Version</b></th>
          <td style="vertical-align: middle;">{{ current['version'] }}</td>
        </tr>
      </tbody>
    </table>
    <h6 class="text-white">Target ISY:</h6>
    <table class="table table-striped table-bordered table-hover" style="font-size: 12px;">
      <tbody>
        <tr>
          <th width="25%" style="vertical-align: middle;"><b>Alias</b></th>
          <td style="vertical-align: middle;">{{ settingsService.currentIsy.value['name'] }}</td>
        </tr>
        <tr>
          <th style="vertical-align: middle;"><b>UUID</b></th>
          <td style="vertical-align: middle;">{{ settingsService.currentIsy.value['uuid'] }}</td>
        </tr>
        <tr>
          <th style="vertical-align: middle;"><b>Firmware</b></th>
          <td style="vertical-align: middle;">{{ settingsService.currentIsy.value['version'] }}</td>
        </tr>
      </tbody>
    </table>
    Do you wish to install this NodeServer on to the target device? <br /><br />
    <b>NOTE</b>: If you are trying to upgrade a NodeServer that is already installed, stop and
    re-start it from the dashboard. It will automatically load the newest version available.

    <br />
    <h6 class="text-white">Select Slot Number:</h6>
    <label>Select Available Slot</label><br />
    <select
      [(ngModel)]="selectedSlot"
      class="button"
      class="btn btn-primary dropdown-toggle btn-block"
    >
      <option [ngValue]="0" hidden>Select Slot</option>
      <ng-container
        *ngFor="
          let slot of settingsService.currentNodeServers
            | async
            | reversefilter: settingsService.currentIsy.value['uuid']
        "
      >
        <option *ngIf="slot">{{ slot }}</option>
      </ng-container>
    </select>
  </div>
  <!-- Buttons -->
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="modal.close()">
      Install
    </button>
    <button ngbAutofocus type="button" class="btn btn-primary" (click)="modal.dismiss()">
      Cancel
    </button>
  </div>
</ng-template>
